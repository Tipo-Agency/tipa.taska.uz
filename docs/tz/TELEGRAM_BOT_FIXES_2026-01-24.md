# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram –±–æ—Ç–∞ - 2026-01-24

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∏ "–ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è" –∏ "–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏" –Ω–µ –≤—ã–≤–æ–¥–∏–ª–∏ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∑–∞–¥–∞—á
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `KeyError` –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–§–∞–π–ª—ã:**
- `telegram-bot/bot.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `tasks_today` –∏ `tasks_overdue`

---

### 2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏"

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ —ç—Ç–∞–ø–µ "–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞".

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üÜï –ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏" –≤ –º–µ–Ω—é —Å–¥–µ–ª–æ–∫ (—É–∂–µ –±—ã–ª–∞ –≤ `keyboards.py`)
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `deals_new` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —ç—Ç–∞–ø—É "–Ω–æ–≤–∞—è" –∏–ª–∏ "new" (case-insensitive)

**–§–∞–π–ª—ã:**
- `telegram-bot/keyboards.py` - –∫–Ω–æ–ø–∫–∞ —É–∂–µ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞
- `telegram-bot/bot.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `deals_new` —É–∂–µ –±—ã–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

---

### 3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–±–æ—Ä —ç—Ç–∞–ø–∞ –≤–æ—Ä–æ–Ω–∫–∏ –≤ —Å–¥–µ–ª–∫–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤–æ—Ä–æ–Ω–∫–∏ –Ω–µ –±—ã–ª–æ –≤—ã–±–æ—Ä–∞ —ç—Ç–∞–ø–∞ –≤–æ—Ä–æ–Ω–∫–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `deals_funnel_stage` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –∏ –±—ã–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤–æ—Ä–æ–Ω–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —ç—Ç–∞–ø–æ–≤
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç—Ç–∞–ø –∏–ª–∏ "–í—Å–µ —ç—Ç–∞–ø—ã"
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —ç—Ç–∞–ø–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–¥–µ–ª–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–æ—Ä–æ–Ω–∫–∏ –∏ —ç—Ç–∞–ø–∞

**–§–∞–π–ª—ã:**
- `telegram-bot/bot.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `deals_funnel` –∏ `deals_funnel_stage`
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º `^deals_funnel_stage_`

---

### 4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ª–∏—á–∫—É.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `notifyDealCreated` –≤ `services/notificationService.ts`
- –¢–µ–ø–µ—Ä—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è:
  1. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º—É (–µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω)
  2. **–í—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `role === 'ADMIN'`)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç: –Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—Ç–∞–¥–∏—é, —Å—É–º–º—É, —Å–æ–∑–¥–∞—Ç–µ–ª—è, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ

**–§–∞–π–ª—ã:**
- `services/notificationService.ts` - —Ñ—É–Ω–∫—Ü–∏—è `notifyDealCreated`

**–õ–æ–≥–∏–∫–∞:**
```typescript
// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
const adminUsers = allUsers.filter(user => user.role === 'ADMIN' && !user.isArchived);
for (const admin of adminUsers) {
  const adminTelegramChatId = getUserTelegramChatId(admin);
  if (adminTelegramChatId && notificationPrefs.dealCreated.telegramPersonal) {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º
    if (!assigneeUser || admin.id !== assigneeUser.id) {
      await sendTelegramNotification(...);
    }
  }
}
```

---

### 5. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏ (–≤–∏–¥–Ω–æ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ).

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `settings_toggle_notification`
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–∫, —Ñ—É–Ω–∫—Ü–∏—è –ø—ã—Ç–∞–µ—Ç—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

**–§–∞–π–ª—ã:**
- `telegram-bot/bot.py` - —Ñ—É–Ω–∫—Ü–∏—è `settings_toggle_notification`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
try:
    if category == "settings_notif_tasks":
        await settings_notif_tasks(update, context)
    # ... –¥—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ...
except Exception as category_error:
    logger.error(f"Error returning to category {category}: {category_error}", exc_info=True)
    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
    try:
        await settings_notifications(update, context)
    except:
        await query.answer("‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞")
```

---

### 6. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –¢–ó

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —ç—Ç–∞–ø–∞ –≤–æ—Ä–æ–Ω–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–í—Å–µ —Å–¥–µ–ª–∫–∏"
- –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏" (`deals_new`)
- –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏"
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω—É–º–µ—Ä–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤

**–§–∞–π–ª—ã:**
- `docs/tz/TELEGRAM_BOT_TZ.md`

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. ‚úÖ **–ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è** - –∫–Ω–æ–ø–∫–∞ –≤—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
2. ‚úÖ **–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏** - –∫–Ω–æ–ø–∫–∞ –≤—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
3. ‚úÖ **–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏** - –∫–Ω–æ–ø–∫–∞ –≤—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –Ω–∞ —ç—Ç–∞–ø–µ "–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞"
4. ‚úÖ **–í—ã–±–æ—Ä —ç—Ç–∞–ø–∞ –≤–æ—Ä–æ–Ω–∫–∏** - –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤–æ—Ä–æ–Ω–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä —ç—Ç–∞–ø–∞
5. ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º** - –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
6. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** - –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)

1. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ `notifyTaskCreated` –≤ `services/notificationService.ts`
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è `notificationPrefs` –≤ `useTaskLogic`
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ `telegramUserId` —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á** - –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ `get_today_tasks` –∏ `get_overdue_tasks` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –∑–∞–¥–∞—á–∏ –ø–æ –¥–∞—Ç–µ

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ (–ø–æ—á–µ–º—É –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏–º–µ—é—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `telegramUserId`

---

## –§–∞–π–ª—ã, –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

1. `telegram-bot/bot.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–¥–∞—á –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
2. `services/notificationService.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
3. `docs/tz/TELEGRAM_BOT_TZ.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–æ –¢–ó
